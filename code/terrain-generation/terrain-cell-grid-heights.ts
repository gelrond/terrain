// ********************************************************************************************************************
import { clampZeroOne } from "../helpers/math.helper";
// ********************************************************************************************************************
import { TerrainHeights } from "../terrain/terrain-heights";
// ********************************************************************************************************************
import { TerrainCellGrid } from "./terrain-cell-grid";
// ********************************************************************************************************************
export class TerrainCellGridHeights extends TerrainHeights {

    // ****************************************************************************************************************
    // offsetX - the offset x
    // ****************************************************************************************************************
    private readonly offsetX: number = 0;

    // ****************************************************************************************************************
    // offsetY - the offset y
    // ****************************************************************************************************************
    private readonly offsetY: number = 0;

    // ****************************************************************************************************************
    // constructor
    // ****************************************************************************************************************
    constructor(private readonly grid: TerrainCellGrid) {

        super(0, 0, 0);

        this.offsetX = grid.sizeX >> 1;

        this.offsetY = grid.sizeY >> 1;
    }

    // ****************************************************************************************************************
    // function:    getHeight
    // ****************************************************************************************************************
    // parameters:  x - the x
    // ****************************************************************************************************************
    //              y - the y
    // ****************************************************************************************************************
    // returns:     the height
    // ****************************************************************************************************************
    public getHeight(x: number, y: number): number {

        const ox = this.offsetX + x;

        const oy = this.offsetY + y;

        if (this.grid.valid(ox, oy)) {

            const cell = this.grid.get(ox, oy);

            return clampZeroOne(cell?.height ?? 0);
        }
        return 0;
    }
}
